<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visualisation, Exploration and Explanation</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2018-09-18">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="PredictionExplainers.html">
<link rel="next" href="breakDown.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#model-lifecycle"><i class="fa fa-check"></i><b>1.1</b> Model Lifecycle</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#why-do-we-need-model-explainers"><i class="fa fa-check"></i><b>1.2</b> Why do we need model explainers?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#black-box-models-vs-white-box-models"><i class="fa fa-check"></i><b>1.3</b> Black-box models vs White-box models</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#model-agnostic-vs-model-specific"><i class="fa fa-check"></i><b>1.4</b> Model agnostic vs Model specific</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#glossary-notation"><i class="fa fa-check"></i><b>1.5</b> Glossary / Notation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.6</b> Thanks to</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="prediction-level-explanations.html"><a href="prediction-level-explanations.html"><i class="fa fa-check"></i>Prediction level explanations</a></li>
<li class="chapter" data-level="2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#variable-atribution-vs-what-if-analysis"><i class="fa fa-check"></i><b>2.1</b> Variable atribution vs What-if analysis</a></li>
<li class="chapter" data-level="2.2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#when-to-use"><i class="fa fa-check"></i><b>2.2</b> When to use?</a></li>
<li class="chapter" data-level="2.3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#three-single-laws"><i class="fa fa-check"></i><b>2.3</b> A bit of philosophy: Three Laws for Prediction Level Explanations</a></li>
<li class="chapter" data-level="2.4" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#example-promoted-or-fired"><i class="fa fa-check"></i><b>2.4</b> Example: Promoted or Fired?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="VAlinMod.html"><a href="VAlinMod.html"><i class="fa fa-check"></i><b>3</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="3.1" data-path="VAlinMod.html"><a href="VAlinMod.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>4</b> Break Down</a><ul>
<li class="chapter" data-level="4.1" data-path="breakDown.html"><a href="breakDown.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="breakDown.html"><a href="breakDown.html#how-to-read-break-down-plots"><i class="fa fa-check"></i><b>4.2</b> How to read Break Down Plots?</a></li>
<li class="chapter" data-level="4.3" data-path="breakDown.html"><a href="breakDown.html#how-to-construct-break-down-plots"><i class="fa fa-check"></i><b>4.3</b> How to construct Break Down Plots</a></li>
<li class="chapter" data-level="4.4" data-path="breakDown.html"><a href="breakDown.html#interactions"><i class="fa fa-check"></i><b>4.4</b> Interactions</a></li>
<li class="chapter" data-level="4.5" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons"><i class="fa fa-check"></i><b>4.5</b> Pros and cons</a></li>
<li class="chapter" data-level="4.6" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>5</b> Shapley Values</a><ul>
<li class="chapter" data-level="5.1" data-path="shapley.html"><a href="shapley.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="shapley.html"><a href="shapley.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.2</b> Pros and cons</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>6</b> LIME: Local Interpretable Model-Agnostic Explanations</a></li>
<li class="chapter" data-level="7" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>7</b> Ceteris Paribus Principle</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>7.2</b> 1D profiles</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>7.3</b> Profile oscillations</a></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>7.4</b> 2D profiles</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>7.5</b> Local model fidelity</a></li>
<li class="chapter" data-level="7.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons-2"><i class="fa fa-check"></i><b>7.6</b> Pros and cons</a></li>
<li class="chapter" data-level="7.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>7.7</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="8" data-path="introduction-5.html"><a href="introduction-5.html"><i class="fa fa-check"></i><b>8</b> Introduction</a><ul>
<li class="chapter" data-level="8.1" data-path="introduction-5.html"><a href="introduction-5.html#example-price-prediction"><i class="fa fa-check"></i><b>8.1</b> Example: Price prediction</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="variable-importance.html"><a href="variable-importance.html"><i class="fa fa-check"></i><b>9</b> Variable Importance</a></li>
<li class="chapter" data-level="10" data-path="marginal-response.html"><a href="marginal-response.html"><i class="fa fa-check"></i><b>10</b> Marginal Response</a><ul>
<li class="chapter" data-level="10.1" data-path="marginal-response.html"><a href="marginal-response.html#partial-dependency-plots"><i class="fa fa-check"></i><b>10.1</b> Partial Dependency Plots</a></li>
<li class="chapter" data-level="10.2" data-path="marginal-response.html"><a href="marginal-response.html#merging-path-plots"><i class="fa fa-check"></i><b>10.2</b> Merging Path Plots</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="performance-diagnostic.html"><a href="performance-diagnostic.html"><i class="fa fa-check"></i><b>11</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="12" data-path="residual-diagnostic.html"><a href="residual-diagnostic.html"><i class="fa fa-check"></i><b>12</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="13" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>13</b> Other topics</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisation, Exploration and Explanation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="VAlinMod" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Variable attribution for linear models</h1>
<p>Linear models are by far the most know predictive models. In this section we explain how variable attribution works for this class of models. We use linear models for the sake of simplicity, but all results may be easily transferred to wider class of additive models. Understanding of concepts presented here will also help in sections @ref{shapley} and @ref{breakDown}.</p>
<p>The main goal of variable attribution is to decompose model prediction in to parts that may be attributed to particular variables. Additive decomposition should have following structure</p>
<p><span class="math display">\[
f(x) = b(f) + v(f, x, x_1) + ... + v(f, x, x_p)
\]</span>
where <span class="math inline">\(b(f)\)</span> (as in baseline) is a model specific, while <span class="math inline">\(v(f, x, x_i)\)</span> stands for contribution of variable <span class="math inline">\(x_i\)</span> in model <span class="math inline">\(f\)</span> for observation <span class="math inline">\(x\)</span>.</p>
<p>Think of following use cases:</p>
<ul>
<li>Think about a model for hart attack. A patient wants to know which factors have highest impact on the final heart risk score.</li>
<li>Think about a model for apartment prices. An investor wants to know how much of the final price may be attributed to the location of an apartment.</li>
<li>Think about a model for credit scoring. A customer wants to know if factors like gender, age or number of kids influence model decisions.</li>
</ul>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>Linear model with coefficients <span class="math inline">\(\beta = (\beta_0, \beta_1, .., \beta_p)\)</span> has following form.</p>
<p><span class="math display">\[
f(x) = \beta_0 + x_1 \beta_1 + \ldots + x_p \beta_p
\]</span>
In other words, model response is the sum of weighted elements of <span class="math inline">\(x = (x_1, x_2, \ldots, x_p) \in X \subset \mathcal R^p\)</span>.</p>
<p>From a perspective of a global model, the most interesting questions are which variables are important globally or how accurate are model predictions.</p>
<p>From the local perspective, we would like to know how particular variables affect model response.</p>
<p>The logic behind the attribution is the following. <span class="math inline">\(\beta_i x_i\)</span> is the part of linear model that depends on <span class="math inline">\(x_i\)</span>. Contribution <span class="math inline">\(v(f, i)\)</span> of the variable <span class="math inline">\(i\)</span> will be difference between this part and its average value.</p>
<p><span class="math display">\[
v(f, i) = \beta_i x_i  - E \beta_i X_i = \beta_i (x_i - \bar x_i)
\]</span></p>
<p><strong>NOTE</strong></p>
<p>It may be a supprise, that the attribution for variable <span class="math inline">\(x_i\)</span> is not the <span class="math inline">\(\beta_i x_i\)</span> but itâ€™s centered version. So, please consider following example.
Figure <a href="VAlinMod.html#fig:attribution1">3.1</a> shows the relation between alcohol and wine quality, based on the wine dataset [TODO: citation needed]. The corresponding linear model is</p>
<p><span class="math display">\[
quality(alcohol) = 2.5820 + 0.3135 * alcohol
 \]</span></p>
<p>It would be confussing to say, that for the weakest wine (alcohol = 8%) contribution on quality is <span class="math inline">\(0.3135*8 = 2.508\)</span>. It is much easier to interpret the variable contribution if it is relative to average concentration of alcohol, which is for this dataset 10.51.</p>
<p>So the contribution of an variable is <span class="math inline">\(0.3135 *(8-10.51) = -0.786885\)</span>. It means that low value of alcohol for this wine (8%) lower the prediction of quality by <span class="math inline">\(-0.786885\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:attribution1"></span>
<img src="figure/attribution_1.png" alt="(fig:attribution1) Relation between wine quality and concentraction of alcohol " width="50%" />
<p class="caption">
Figure 3.1: (fig:attribution1) Relation between wine quality and concentraction of alcohol
</p>
</div>
<p>In this case it is easy to attribute the impact of feature <span class="math inline">\(x_i\)</span> to prediction <span class="math inline">\(f(x^{new})\)</span>. The most straightforward approach would be to use the <span class="math inline">\(x^{new}_i \beta_i\)</span> as the attribution. However, it is easier to interpret variable attributions if they are invariant to scale-location transformations of <span class="math inline">\(x_i\)</span>, such as change of the unit or origin. This is why for linear models the  variable attributions are defined as <span class="math inline">\((x^{new}_i - \bar x_i) \beta_i\)</span>. The equation  may be rewritten as follows:</p>
<span class="math display">\[\begin{equation}
f(x^{new}) = (1, x^{new}) (\mu, \beta)^T = baseline + (x^{new}_1 - \bar x_1) \beta_1 + ... + (x^{new}_p - \bar x_p) \beta_p
\end{equation}\]</span>
<p>where
<span class="math display">\[
baseline = \mu + \bar x_1 \beta_1 + ... + \bar x_p \beta_p.
\]</span></p>
<p>Components <span class="math inline">\((x^{new}_i - \bar x_i) \beta_i\)</span> are all expressed in the same units. For  and  models these values are calculated and plotted by the generic  function from the  package.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PredictionExplainers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="breakDown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
