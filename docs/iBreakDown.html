<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-06-10">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="breakDown.html">
<link rel="next" href="shapley.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#notes-to-readers"><i class="fa fa-check"></i><b>1.1</b> Notes to readers</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.2</b> The aim of the book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.3</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.4</b> Terminology</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.5</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.6</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.7</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#notation"><i class="fa fa-check"></i><b>1.8</b> Notation</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#bookstructure"><i class="fa fa-check"></i><b>1.9</b> The structure of the book</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.10</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html"><i class="fa fa-check"></i><b>2</b> Do-it-yourself With R</a><ul>
<li class="chapter" data-level="2.1" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#what-to-install"><i class="fa fa-check"></i><b>2.1</b> What to install?</a></li>
<li class="chapter" data-level="2.2" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-work-with-dalex"><i class="fa fa-check"></i><b>2.2</b> How to work with <code>DALEX</code>?</a></li>
<li class="chapter" data-level="2.3" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-work-with-archivist"><i class="fa fa-check"></i><b>2.3</b> How to work with <code>archivist</code>?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="PythonCodeSnippets.html"><a href="PythonCodeSnippets.html"><i class="fa fa-check"></i><b>3</b> Do-it-yourself With Python</a></li>
<li class="chapter" data-level="4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>4</b> Data Sets</a><ul>
<li class="chapter" data-level="4.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>4.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="4.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration-titanic"><i class="fa fa-check"></i><b>4.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-titanic-lmr"><i class="fa fa-check"></i><b>4.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="4.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-titanic-rf"><i class="fa fa-check"></i><b>4.1.3</b> Random forest</a></li>
<li class="chapter" data-level="4.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-titanic-gbm"><i class="fa fa-check"></i><b>4.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="4.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions-titanic"><i class="fa fa-check"></i><b>4.1.5</b> Model predictions</a></li>
<li class="chapter" data-level="4.1.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ExplainersTitanicRCode"><i class="fa fa-check"></i><b>4.1.6</b> Explainers</a></li>
<li class="chapter" data-level="4.1.7" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsTitanic"><i class="fa fa-check"></i><b>4.1.7</b> List of objects for the <code>titanic</code> example</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>4.2</b> Apartment prices</a><ul>
<li class="chapter" data-level="4.2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration-apartments"><i class="fa fa-check"></i><b>4.2.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-Apartments-lr"><i class="fa fa-check"></i><b>4.2.2</b> Linear regression</a></li>
<li class="chapter" data-level="4.2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-Apartments-rf"><i class="fa fa-check"></i><b>4.2.3</b> Random forest</a></li>
<li class="chapter" data-level="4.2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictionsApartments"><i class="fa fa-check"></i><b>4.2.4</b> Model predictions</a></li>
<li class="chapter" data-level="4.2.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsApartments"><i class="fa fa-check"></i><b>4.2.5</b> List of objects for the <code>apartments</code> example</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>4.3</b> Hire or fire</a><ul>
<li class="chapter" data-level="4.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration-HR"><i class="fa fa-check"></i><b>4.3.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-HR-mr"><i class="fa fa-check"></i><b>4.3.2</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="4.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-HR-rf"><i class="fa fa-check"></i><b>4.3.3</b> Random forest</a></li>
<li class="chapter" data-level="4.3.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictionsHR"><i class="fa fa-check"></i><b>4.3.4</b> Model predictions</a></li>
<li class="chapter" data-level="4.3.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsHR"><i class="fa fa-check"></i><b>4.3.5</b> List of objects for the <code>HR</code> example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="5" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>5</b> Introduction</a></li>
<li class="chapter" data-level="6" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>6</b> Ceteris-paribus Profiles and What-If Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>6.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>6.5</b> Pros and cons</a></li>
<li class="chapter" data-level="6.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>6.6</b> Code snippets for R</a><ul>
<li class="chapter" data-level="6.6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#basic-use-of-the-ceteris_paribus-function"><i class="fa fa-check"></i><b>6.6.1</b> Basic use of the <code>ceteris_paribus</code> function</a></li>
<li class="chapter" data-level="6.6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#advanced-use-of-the-ceteris_paribus-function"><i class="fa fa-check"></i><b>6.6.2</b> Advanced use of the <code>ceteris_paribus</code> function</a></li>
<li class="chapter" data-level="6.6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#champion-challenger-analysis"><i class="fa fa-check"></i><b>6.6.3</b> Champion-challenger analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>7</b> Ceteris-paribus Oscillations and Local Variable-importance</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>7.3</b> Method</a></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>7.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>7.5</b> Pros and cons</a></li>
<li class="chapter" data-level="7.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>7.6</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#basic-use-of-the-calculate_oscillations-function"><i class="fa fa-check"></i><b>7.6.1</b> Basic use of the <code>calculate_oscillations</code> function</a></li>
<li class="chapter" data-level="7.6.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#advanced-use-of-the-calculate_oscillations-function"><i class="fa fa-check"></i><b>7.6.2</b> Advanced use of the <code>calculate_oscillations</code> function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>8</b> Local Diagnostics With Ceteris-paribus Profiles</a><ul>
<li class="chapter" data-level="8.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagIntro"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagIntuition"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagMethod"><i class="fa fa-check"></i><b>8.3</b> Method</a><ul>
<li class="chapter" data-level="8.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagNeighbors"><i class="fa fa-check"></i><b>8.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="8.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagProfiles"><i class="fa fa-check"></i><b>8.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="8.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagLFplot"><i class="fa fa-check"></i><b>8.3.3</b> Local-fidelity plot</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagExample"><i class="fa fa-check"></i><b>8.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="8.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagProsCons"><i class="fa fa-check"></i><b>8.5</b> Pros and cons</a></li>
<li class="chapter" data-level="8.6" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagR"><i class="fa fa-check"></i><b>8.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>9</b> Break Down for Additive Variable Attributions</a><ul>
<li class="chapter" data-level="9.1" data-path="breakDown.html"><a href="breakDown.html#intuition"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="breakDown.html"><a href="breakDown.html#method"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="breakDown.html"><a href="breakDown.html#example-titanic-data"><i class="fa fa-check"></i><b>9.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="9.5.1" data-path="breakDown.html"><a href="breakDown.html#basic-usage-for-the-break_down-function"><i class="fa fa-check"></i><b>9.5.1</b> Basic usage for the <code>break_down</code> function</a></li>
<li class="chapter" data-level="9.5.2" data-path="breakDown.html"><a href="breakDown.html#advanced-usage-for-the-break_down-function"><i class="fa fa-check"></i><b>9.5.2</b> Advanced usage for the <code>break_down</code> function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>10</b> iBreakDown for Variable Attributions with Interactions</a><ul>
<li class="chapter" data-level="10.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-1"><i class="fa fa-check"></i><b>10.1</b> Intuition</a></li>
<li class="chapter" data-level="10.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-1"><i class="fa fa-check"></i><b>10.2</b> Method</a><ul>
<li class="chapter" data-level="10.2.1" data-path="iBreakDown.html"><a href="iBreakDown.html#single-step-contributions"><i class="fa fa-check"></i><b>10.2.1</b> Single step contributions</a></li>
<li class="chapter" data-level="10.2.2" data-path="iBreakDown.html"><a href="iBreakDown.html#two-steps-contributions"><i class="fa fa-check"></i><b>10.2.2</b> Two steps contributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="iBreakDown.html"><a href="iBreakDown.html#sequential-contributions"><i class="fa fa-check"></i><b>10.2.3</b> Sequential contributions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-titanic"><i class="fa fa-check"></i><b>10.3</b> Example: Titanic</a></li>
<li class="chapter" data-level="10.4" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-1"><i class="fa fa-check"></i><b>10.4</b> Pros and cons</a></li>
<li class="chapter" data-level="10.5" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>10.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>11</b> SHapley Additive exPlanations (SHAP) and Average Variable Attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="shapley.html"><a href="shapley.html#intuition-2"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="shapley.html"><a href="shapley.html#method-2"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="shapley.html"><a href="shapley.html#titanic"><i class="fa fa-check"></i><b>11.3</b> Titanic</a></li>
<li class="chapter" data-level="11.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-2"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>12</b> Local Interpretable Model-Agnostic Explanations (LIME)</a><ul>
<li class="chapter" data-level="12.1" data-path="LIME.html"><a href="LIME.html#intuition-3"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="LIME.html"><a href="LIME.html#method-3"><i class="fa fa-check"></i><b>12.2</b> Method</a></li>
<li class="chapter" data-level="12.3" data-path="LIME.html"><a href="LIME.html#pros-and-cons-3"><i class="fa fa-check"></i><b>12.3</b> Pros and cons</a></li>
<li class="chapter" data-level="12.4" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>12.4</b> Code snippets for R</a><ul>
<li class="chapter" data-level="12.4.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>12.4.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="12.4.2" data-path="LIME.html"><a href="LIME.html#the-localmodel-package"><i class="fa fa-check"></i><b>12.4.2</b> <strong>The localModel package</strong></a></li>
<li class="chapter" data-level="12.4.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>12.4.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="CompareInstance.html"><a href="CompareInstance.html"><i class="fa fa-check"></i><b>13</b> Comparision of Instance-level Explainers</a><ul>
<li class="chapter" data-level="13.1" data-path="CompareInstance.html"><a href="CompareInstance.html#when-to-use"><i class="fa fa-check"></i><b>13.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="ModelLevelExplanations.html"><a href="ModelLevelExplanations.html"><i class="fa fa-check"></i><b>14</b> Model level explanations</a></li>
<li class="chapter" data-level="15" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>15</b> Introduction</a><ul>
<li class="chapter" data-level="15.1" data-path="introduction-1.html"><a href="introduction-1.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>15.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="15.2" data-path="introduction-1.html"><a href="introduction-1.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>15.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>16</b> Feature Importance</a><ul>
<li class="chapter" data-level="16.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>16.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="16.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic-1"><i class="fa fa-check"></i><b>16.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="16.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>16.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="16.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>16.4</b> More models</a></li>
<li class="chapter" data-level="16.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>16.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>17</b> Feature effects</a><ul>
<li class="chapter" data-level="17.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>17.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>18</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="18.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>18.1</b> Definition</a></li>
<li class="chapter" data-level="18.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>18.2</b> Estimation</a></li>
<li class="chapter" data-level="18.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>18.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="18.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>18.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="18.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>18.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>19</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
<li class="chapter" data-level="19.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>19.2</b> Estimation</a></li>
<li class="chapter" data-level="19.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>19.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>20</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="20.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>20.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>21</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="22" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>22</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="23" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>23</b> Other topics</a></li>
<li class="chapter" data-level="24" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>24</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="25" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>25</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="26" data-path="conceptDrift.html"><a href="conceptDrift.html"><i class="fa fa-check"></i><b>26</b> Concept Drift</a><ul>
<li class="chapter" data-level="26.1" data-path="conceptDrift.html"><a href="conceptDrift.html#introduction-2"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="conceptDrift.html"><a href="conceptDrift.html#covariate-drift"><i class="fa fa-check"></i><b>26.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="26.3" data-path="conceptDrift.html"><a href="conceptDrift.html#code-snippets"><i class="fa fa-check"></i><b>26.3</b> Code snippets</a></li>
<li class="chapter" data-level="26.4" data-path="conceptDrift.html"><a href="conceptDrift.html#residual-drift"><i class="fa fa-check"></i><b>26.4</b> Residual Drift</a></li>
<li class="chapter" data-level="26.5" data-path="conceptDrift.html"><a href="conceptDrift.html#code-snippets-1"><i class="fa fa-check"></i><b>26.5</b> Code snippets</a></li>
<li class="chapter" data-level="26.6" data-path="conceptDrift.html"><a href="conceptDrift.html#model-drift"><i class="fa fa-check"></i><b>26.6</b> Model Drift</a></li>
<li class="chapter" data-level="26.7" data-path="conceptDrift.html"><a href="conceptDrift.html#code-snippets-2"><i class="fa fa-check"></i><b>26.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="27" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>27</b> Data Sets</a><ul>
<li class="chapter" data-level="27.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>27.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>28</b> Packages</a><ul>
<li class="chapter" data-level="28.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>28.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="29" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>29</b> Ceteris-paribus Two-dimensional Profiles - a Tool for Pairwise Interactions</a><ul>
<li class="chapter" data-level="29.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dIntro"><i class="fa fa-check"></i><b>29.1</b> Introduction</a></li>
<li class="chapter" data-level="29.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dIntuition"><i class="fa fa-check"></i><b>29.2</b> Intuition</a></li>
<li class="chapter" data-level="29.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dMethod"><i class="fa fa-check"></i><b>29.3</b> Method</a></li>
<li class="chapter" data-level="29.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dExample"><i class="fa fa-check"></i><b>29.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="29.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dProsCons"><i class="fa fa-check"></i><b>29.5</b> Pros and cons</a></li>
<li class="chapter" data-level="29.6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2R"><i class="fa fa-check"></i><b>29.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>30</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="30.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-3"><i class="fa fa-check"></i><b>30.1</b> Introduction</a></li>
<li class="chapter" data-level="30.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-4"><i class="fa fa-check"></i><b>30.2</b> Intuition</a></li>
<li class="chapter" data-level="30.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method-4"><i class="fa fa-check"></i><b>30.3</b> Method</a></li>
<li class="chapter" data-level="30.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>30.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="30.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-4"><i class="fa fa-check"></i><b>30.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="30.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-3"><i class="fa fa-check"></i><b>30.6</b> Code snippets</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iBreakDown" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> iBreakDown for Variable Attributions with Interactions</h1>
<p>In the Section <a href="breakDown.html#breakDown">9</a> we presented a model agnostic approach to additive decomposition of model predictions. We also showed that for non-additive moedls the proposed attribution depends on the ordering of variables.</p>
<p>Lack of additivness means, that effect of one variable is modulated by another variable(s). In such pair (or larger tuple) a single variable does not contribute independently, therefore in model explanations they should be presented together.</p>
<p>In this section we present an algorithm that identifies interactions between pairs of variables and include such interactions in variable decomposition plots. Here we present an algorithm for pairs of variables, but it can be easily generalized to larger number of variables.</p>
<div id="intuition-1" class="section level2">
<h2><span class="header-section-number">10.1</span> Intuition</h2>
<p>First, let’s see an example of an interaction between two variables.
We will use real data from the Titanic dataset. Table <a href="iBreakDown.html#tab:titanicMaleSurvival">10.1</a> shows survival statistics for men on Titanic. For the sake of simplicity, in this example we consider only two variables - <code>age</code> and <code>class</code>. In the data <code>age</code> is a continuous variable, but again, for simplicity we have dychotomized it into two levels: boys (0-16 years old) and adults (17+ years old).</p>
<p>Suppose that we would like to explain factors that contribute to the survival of kids from the second class. As we can read, the survival for young passengers from 2nd class is 91.7% (survived 11 out of 12 male passengers in this group). It is higher than survival for men on titanic which is 20.5% (survived 352 out of 1716 men). So the question is, how age and class contribute to this higher survival?</p>
<p>Let us consider two explanations, that correspond to two different orderings:</p>
<ul>
<li>Overall men survival is 20.5%, but when we condition on male passengers from 2nd class the survival is even lower, i.e. 13.5%. Thus effect of the 2nd class is negative, it decreases the probability of survival by 7 percent points. Being a kid in the 2nd class is very lucky though. It changes of survival increase from 13.5% (male 2nd class) to 91.7% (boys from 2nd class). It’s an increase by 78.2 percent points. So the contributions are -7% for class and +78.2% for age.</li>
<li>Overall men survival is 20.5%, but when we condition on young man then the survival is higher, i.e. 40.7%. Thus the effect of age is positive, being a boy increases the probability of survival by 20.2 percent points. Being a kid in 2nd class is even better, it changes the survival increase from 40.7% (boys) to 91.7% (boys from 2nd class). It’s an increase by 51 percent points. So the contributions are +51% for class and +20.2% for age.</li>
</ul>
<p>As we see these two paths leads to two very different explanations. They differ not only in the size but also in the sign of attributed importance.
It has happend because one variable modulate effect on the second variable as the moedl is not additive. Below we will show how to deal with such cases.</p>
<table>
<caption><span id="tab:titanicMaleSurvival">Table 10.1: </span> Survival rates for men on Titanic. Ratios show how many survived in each Class/Age category.</caption>
<thead>
<tr class="header">
<th align="left">Class / Age</th>
<th align="left">Kids (0-16)</th>
<th align="left">Adults (&gt;16)</th>
<th align="left">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1st</td>
<td align="left">5/5 = 100%</td>
<td align="left">57/175 = 32.6%</td>
<td align="left">62/180 = 34.4%</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">11/12 = 91.7%</td>
<td align="left">13/166 = 7.8%</td>
<td align="left">24/178 = 13.5%</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">17/61 = 27.9%</td>
<td align="left">58/430 = 13.5%</td>
<td align="left">75/491 = 15.3%</td>
</tr>
<tr class="even">
<td align="left">deck crew</td>
<td align="left"></td>
<td align="left">43/66 = 65.2%</td>
<td align="left">43/66 = 65.2%</td>
</tr>
<tr class="odd">
<td align="left">engineering crew</td>
<td align="left"></td>
<td align="left">71/324 = 21.9%</td>
<td align="left">71/324 = 21.9%</td>
</tr>
<tr class="even">
<td align="left">restaurant staff</td>
<td align="left"></td>
<td align="left">1/67 = 1.5%</td>
<td align="left">1/67 = 1.5%</td>
</tr>
<tr class="odd">
<td align="left">victualling crew</td>
<td align="left">0/3 = 0%</td>
<td align="left">76/407 = 18.7%</td>
<td align="left">76/410 = 18.5%</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="left">33/81 = 40.7%</td>
<td align="left">319/1635 = 19.5%</td>
<td align="left">352/1716 = 20.5%</td>
</tr>
</tbody>
</table>
<p>The key intuition behind an iBreakDown algorithm is to include variable interactions to the visual explanations.
To do this we need to identify some candidated for interactions. Here we propose a very simple algorithm that will do this in two steps.</p>
<ol style="list-style-type: decimal">
<li>First it will calculate variable contributions for each variable independently.</li>
<li>Second it will calculate joint effect for each pair of variables. If this effect is different than the sum of separate variables then such pair is identified as candidate for an interaction.</li>
</ol>
</div>
<div id="method-1" class="section level2">
<h2><span class="header-section-number">10.2</span> Method</h2>
<p>Identification of interactions in the model is performed in three steps <span class="citation">(Gosiewska and Biecek <a href="#ref-iBreakDownRPackage">2019</a><a href="#ref-iBreakDownRPackage">a</a>)</span></p>
<ul>
<li>Calculate a <em>single-step</em> contribution for each variable.</li>
<li>Calculate a <em>single-step</em> contribution for every pair of variables. Subtract individual contributions to assess the size of non additivness.</li>
<li>Order interaction effects and additive effects in a list to determin the final order for conditioning/explanations.</li>
</ul>
<p>This simple intuition may be generalized into higher order interactions.</p>
<div id="single-step-contributions" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Single step contributions</h3>
<p>For a feature <span class="math inline">\(x_i\)</span> we may define a single-step contribution as
<span class="math display">\[
\Delta^j =  \mathbb{E}[f(x)|x^j = x_*^j] - \mathbb{E}[f(x)].
\]</span></p>
<p>The expected model prediction <span class="math inline">\(\mathbb{E}[f(x)]\)</span> is sometimes called baseline or intercept and may be denoted as <span class="math inline">\(\Delta_\varnothing\)</span>.</p>
<p>Expected value <span class="math inline">\(\mathbb{E}[f(x)|x^j = x_*^j]\)</span> corresponds to an average prediction of a model <span class="math inline">\(f\)</span> if feature <span class="math inline">\(x_j\)</span> is fixed on <span class="math inline">\(x^j_*\)</span> coordinate from the observation to explain <span class="math inline">\(x_*\)</span>.</p>
<p>I.e. the <span class="math inline">\(\Delta^j\)</span> is the difference between expected model response after conditioning on <span class="math inline">\(j\)</span> variable minus the expected model response. <span class="math inline">\(\Delta^j\)</span> measures a naive single-step local variable importance, it indicates how much the average prediction of model <span class="math inline">\(f\)</span> changes if feature <span class="math inline">\(x^j\)</span> is set on <span class="math inline">\(x_*^j\)</span>.</p>
</div>
<div id="two-steps-contributions" class="section level3">
<h3><span class="header-section-number">10.2.2</span> Two steps contributions</h3>
<p>For a pair of variables <span class="math inline">\(x_i\)</span>, <span class="math inline">\(x_j\)</span> we introduce a single-step contribution as
<span class="math display">\[
\Delta^{ij} =  \mathbb{E}[f(x)|x^i = x_*^i, x^j = x_*^j] - \mathbb{E}[f(x)].
\]</span></p>
<p>And non additive component of this contribution as</p>
<p><span class="math display">\[
\Delta_{I}^{ij} =  \mathbb{E}[f(x)|x^i = x_*^i, x^j = x_*^j] -  \mathbb{E}[f(x)|x^i = x_*^i] -  \mathbb{E}[f(x)|x^j = x_*^j] + \mathbb{E}[f(x)].
\]</span></p>
<p>Or equivalently</p>
<p><span class="math display">\[
\Delta_{I}^{ij} = \Delta^{ij} - \Delta^i - \Delta^j. 
\]</span></p>
</div>
<div id="sequential-contributions" class="section level3">
<h3><span class="header-section-number">10.2.3</span> Sequential contributions</h3>
<p>The <span class="math inline">\(\Delta_{I}^{ij}\)</span> is the difference between collective effect of variables <span class="math inline">\(x^i\)</span> and <span class="math inline">\(x^j\)</span> denoted as <span class="math inline">\(\Delta^{ij}\)</span> and their additive effects <span class="math inline">\(\Delta^{i}\)</span> and <span class="math inline">\(\Delta^{j}\)</span>. Therefore, <span class="math inline">\(\Delta_{I}^{ij}\)</span> measures the importance of local lack-of-additivnes (aka. interaction) between features <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.
For additive models <span class="math inline">\(\Delta_{I}^{ij}\)</span> should be small~for any <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>.</p>
<p>Note that contributions <span class="math inline">\(\Delta^{i}\)</span> do not sum to final model prediction. We only use them to determine the order of features in which the instance shall be explained. To calculate contributions that have the property of <em>local accuracy</em> we need to introduce one more symbol, that corresponds to the added contribution of feature <span class="math inline">\(i\)</span> to the set of features~<span class="math inline">\(J\)</span>.</p>
<p><span class="math display">\[
\Delta^{i|J} = \mathbf{E}[f(X)| x^{J\cup\{i\}} = x^{J\cup\{i\}}_{*}] -  \mathbf{E}[f(X)| x^{J} = x^{J}_{*}] =     \Delta^{J\cup\{i\}} - \Delta^{J}.
\]</span></p>
<p>And for pairs of features</p>
<p><span class="math display">\[
\Delta^{ij|J} = \mathbf{E}[f(X)| x^{J\cup\{i,j\}} = x^{J\cup\{i,j\}}_{*}] -  \mathbf{E}[f(X)| x^{J} = x^{J}_{*}] = 
    \Delta^{J\cup\{i,j\}} - \Delta^{J}.
\]</span></p>
<p>Once the order of single-step importance is determined based on <span class="math inline">\(\Delta^i\)</span> and <span class="math inline">\(\Delta_{I}^{ij}\)</span> scores, the final explanation is the attribution to the sequence of <span class="math inline">\(\Delta^{i|J}\)</span> scores. These contributions sum up to the model predictions, because</p>
<p><span class="math display">\[
\Delta^{1,2...p} = f(x_*) - E[f(X)].
\]</span></p>
<p>This approach can be generalized to interactions between any number of variables.</p>
<p>The complexity of the calculation of single step attributions is <span class="math inline">\(O(p)\)</span> where <span class="math inline">\(p\)</span> stands for the number of variables, wile complexity for all pairs is <span class="math inline">\(O(p^2)\)</span>. The complexity of the consecutive conditioning is <span class="math inline">\(O(p)\)</span>, thus the complexity of whole algorithm is <span class="math inline">\(O(p^2)\)</span>.</p>
</div>
</div>
<div id="example-titanic" class="section level2">
<h2><span class="header-section-number">10.3</span> Example: Titanic</h2>
<p>In this example we will use a random forest model for Titanic data and Johny D example - an 8 years old boy from 1st class.</p>
<p>In Table <a href="iBreakDown.html#tab:titanicIBreakDownList">10.2</a> we showed expected model responses <span class="math inline">\(\mathbb{E}[f(x)|x^i = x_*^i, x^j = x_*^j]\)</span>, single-step effects <span class="math inline">\(\Delta^{ij}\)</span> and non-additive effects <span class="math inline">\(\Delta_{I}^{ij}\)</span> for each variable and each pair of variables. All these values are calculated locally for Johny D. These values are sorted along local importance, most important to the top.</p>
<p>Based on this ordering a following sequence of variables are indentified as informative: <code>age</code>, <code>fare:class</code>, <code>gender</code>. <code>embarked</code>, <code>sibsp</code> and <code>parch</code>.</p>
<p>Once the ordering is specified, in the table <a href="iBreakDown.html#tab:titanicIBreakDownList2">10.3</a> we showed how the sequential attribution is calculated. These values are then presented in the iBreakDown plot <a href="iBreakDown.html#fig:iBreakDownTitanicExamplePlot">10.1</a>.</p>
<table>
<caption><span id="tab:titanicIBreakDownList">Table 10.2: </span> For each variable and each pair of variables we calculated the expected conditional model response, the difference between conditional model response and the baseline and for pairs of variables the non-additive contribution. Rows are sorted according to the absolute value of the last column (if provided).</caption>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="right"><span class="math inline">\(E[f(x):x^{ij}= x_*^{ij}]\)</span></th>
<th align="right"><span class="math inline">\(\Delta^{ij}\)</span></th>
<th align="right"><span class="math inline">\(\Delta_I^{ij}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.505</td>
<td align="right">0.270</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">fare:class</td>
<td align="right">0.333</td>
<td align="right">0.098</td>
<td align="right">-0.231</td>
</tr>
<tr class="odd">
<td align="left">class</td>
<td align="right">0.420</td>
<td align="right">0.185</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">fare:age</td>
<td align="right">0.484</td>
<td align="right">0.249</td>
<td align="right">-0.164</td>
</tr>
<tr class="odd">
<td align="left">fare</td>
<td align="right">0.379</td>
<td align="right">0.143</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">0.110</td>
<td align="right">-0.125</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">age:class</td>
<td align="right">0.591</td>
<td align="right">0.355</td>
<td align="right">-0.100</td>
</tr>
<tr class="even">
<td align="left">age:gender</td>
<td align="right">0.451</td>
<td align="right">0.215</td>
<td align="right">0.070</td>
</tr>
<tr class="odd">
<td align="left">fare:gender</td>
<td align="right">0.280</td>
<td align="right">0.045</td>
<td align="right">0.027</td>
</tr>
<tr class="even">
<td align="left">embarked</td>
<td align="right">0.225</td>
<td align="right">-0.011</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">embarked:age</td>
<td align="right">0.504</td>
<td align="right">0.269</td>
<td align="right">0.010</td>
</tr>
<tr class="even">
<td align="left">parch:gender</td>
<td align="right">0.100</td>
<td align="right">-0.136</td>
<td align="right">-0.008</td>
</tr>
<tr class="odd">
<td align="left">sibsp</td>
<td align="right">0.243</td>
<td align="right">0.008</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">sibsp:age</td>
<td align="right">0.520</td>
<td align="right">0.284</td>
<td align="right">0.007</td>
</tr>
<tr class="odd">
<td align="left">sibsp:class</td>
<td align="right">0.422</td>
<td align="right">0.187</td>
<td align="right">-0.006</td>
</tr>
<tr class="even">
<td align="left">embarked:fare</td>
<td align="right">0.374</td>
<td align="right">0.138</td>
<td align="right">0.006</td>
</tr>
<tr class="odd">
<td align="left">sibsp:gender</td>
<td align="right">0.113</td>
<td align="right">-0.123</td>
<td align="right">-0.005</td>
</tr>
<tr class="even">
<td align="left">fare:parch</td>
<td align="right">0.380</td>
<td align="right">0.145</td>
<td align="right">0.005</td>
</tr>
<tr class="odd">
<td align="left">parch:sibsp</td>
<td align="right">0.236</td>
<td align="right">0.001</td>
<td align="right">-0.004</td>
</tr>
<tr class="even">
<td align="left">parch</td>
<td align="right">0.232</td>
<td align="right">-0.003</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">parch:age</td>
<td align="right">0.500</td>
<td align="right">0.264</td>
<td align="right">-0.002</td>
</tr>
<tr class="even">
<td align="left">embarked:gender</td>
<td align="right">0.101</td>
<td align="right">-0.134</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">embarked:parch</td>
<td align="right">0.223</td>
<td align="right">-0.012</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">fare:sibsp</td>
<td align="right">0.387</td>
<td align="right">0.152</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">embarked:class</td>
<td align="right">0.409</td>
<td align="right">0.173</td>
<td align="right">-0.001</td>
</tr>
<tr class="even">
<td align="left">gender:class</td>
<td align="right">0.296</td>
<td align="right">0.061</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">embarked:sibsp</td>
<td align="right">0.233</td>
<td align="right">-0.002</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">parch:class</td>
<td align="right">0.418</td>
<td align="right">0.183</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:titanicIBreakDownList2">Table 10.3: </span> Based on identified order we calculated the expected conditional model response and the difference between conditional model response with and without a specified variable. These values are plotted in the iBreakDown plot.</caption>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="right"><span class="math inline">\(\Delta^{i:J}\)</span></th>
<th align="right"><span class="math inline">\(\Delta^{J\cup\{i\}}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">intercept</td>
<td align="right"></td>
<td align="right">0.235</td>
</tr>
<tr class="even">
<td align="left">age = 8</td>
<td align="right">0.269</td>
<td align="right">0.505</td>
</tr>
<tr class="odd">
<td align="left">fare:class = 72:1st</td>
<td align="right">0.039</td>
<td align="right">0.544</td>
</tr>
<tr class="even">
<td align="left">gender = male</td>
<td align="right">-0.083</td>
<td align="right">0.461</td>
</tr>
<tr class="odd">
<td align="left">embarked = Southampton</td>
<td align="right">-0.002</td>
<td align="right">0.458</td>
</tr>
<tr class="even">
<td align="left">sibsp = 0</td>
<td align="right">-0.006</td>
<td align="right">0.452</td>
</tr>
<tr class="odd">
<td align="left">parch = 0</td>
<td align="right">-0.030</td>
<td align="right">0.422</td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center"><span id="fig:iBreakDownTitanicExamplePlot"></span>
<img src="PM_VEE_files/figure-html/iBreakDownTitanicExamplePlot-1.png" alt="(fig:iBreakDownTitanicExamplePlot) Break Down Plots with interactions for Johny D. " width="80%" />
<p class="caption">
Figure 10.1: (fig:iBreakDownTitanicExamplePlot) Break Down Plots with interactions for Johny D.
</p>
</div>
</div>
<div id="pros-and-cons-1" class="section level2">
<h2><span class="header-section-number">10.4</span> Pros and cons</h2>
<p>Break Down for interactions shares many features of Break Down for single variables. Below we summarize unique strengths and weaknesses of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>If interactions are present in the model, then additive contributions may be misleading. In such case the identification of interactions leads to better explanations.</li>
<li>Complexity of Break Down Algorithm is quadratic, what is not that bad if number of features is small or moderate.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>For large number of variables, the consideration of all interactions is both time consuming and sensitive to noise as the number of pairs grow faster than number of variables.</li>
<li>Identification of interaction is not based on significance testing, it’s purely based on absolute empirical effects, thus for small samples this procedure is prone to errors.</li>
</ul>
</div>
<div id="code-snippets-for-r-1" class="section level2">
<h2><span class="header-section-number">10.5</span> Code snippets for R</h2>
<p>In this section we present key features of the <code>iBreakDown</code> package for R <span class="citation">(Gosiewska and Biecek <a href="#ref-iBreakDownRPackage">2019</a><a href="#ref-iBreakDownRPackage">a</a>)</span>. This package covers all features presented in this chapter. It is available on CRAN and GitHub. Find more examples at the website of this package <code>https://modeloriented.github.io/iBreakDown/</code>.</p>
<p>All steps are very similar to these presented in the previouse chapter for variable attributions. The only difference is that the <code>break_down()</code> function will now take <code>interactions = TRUE</code> argument.</p>
<p><strong>Model preparation</strong></p>
<p>As in previous chapters we will use the random forest <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span> model <code>titanic_rf_v6</code> developed for the Titanic dataset (see Section <a href="DataSetsIntro.html#TitanicDataset">4.1</a>).
Using the same model will help us (1) to understand how the Break Down method works, (2) to compare these explanations against methods presented in previous chapters.</p>
<p>So let restore the <code>explain_rf_v6</code> explainer</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2">explain_rf_v6 &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/9b971&quot;</span>)</a>
<a class="sourceLine" id="cb115-3" data-line-number="3"></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb115-5" data-line-number="5">johny_d &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/e3596&quot;</span>)</a>
<a class="sourceLine" id="cb115-6" data-line-number="6">johny_d</a></code></pre></div>
<pre><code>##   class gender age sibsp parch fare    embarked
## 1   1st   male   8     0     0   72 Southampton</code></pre>
<p>The <code>iBreakDown::break_down()</code> function calculates Break Down contributions for a selected model around a selected observation.</p>
<p>The result from <code>break_down()</code> function is a data frame with additive attributions for selected observation.</p>
<p>The simplest use case is to set only the arguments - model explainers and observation of interest.</p>
<p>By default only additive attributions are calculated. Use <code>interactions = TRUE</code> argument to look for interactions.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;iBreakDown&quot;</span>)</a>
<a class="sourceLine" id="cb117-2" data-line-number="2">bd_rf &lt;-<span class="st"> </span><span class="kw">break_down</span>(explain_rf_v6,</a>
<a class="sourceLine" id="cb117-3" data-line-number="3">                 johny_d,</a>
<a class="sourceLine" id="cb117-4" data-line-number="4">                 <span class="dt">interactions =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb117-5" data-line-number="5"></a>
<a class="sourceLine" id="cb117-6" data-line-number="6">bd_rf</a></code></pre></div>
<pre><code>##                                          contribution
## Random Forest v6: intercept                     0.235
## Random Forest v6: age = 8                       0.270
## Random Forest v6: fare:class = 72:1st           0.039
## Random Forest v6: gender = male                -0.083
## Random Forest v6: embarked = Southampton       -0.003
## Random Forest v6: sibsp = 0                    -0.006
## Random Forest v6: parch = 0                    -0.030
## Random Forest v6: prediction                    0.422</code></pre>
<p>The generic <code>plot()</code> function creates a Break Down plots.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">plot</span>(bd_rf) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-iBreakDownRPackage">
<p>Gosiewska, Alicja, and Przemyslaw Biecek. 2019a. “iBreakDown: Uncertainty of Model Explanations for Non-additive Predictive Models.” <a href="https://arxiv.org/abs/1903.11420v1">https://arxiv.org/abs/1903.11420v1</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="breakDown.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="shapley.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
